# Baseline configuration for Cascade Mask R-CNN model

# Model configuration
model:
  backbone:
    name: 'resnet50'
    pretrained: true
    freeze_stages: 1
    norm_eval: true
    out_indices: [0, 1, 2, 3]
  
  fpn:
    in_channels: [256, 512, 1024, 2048]
    out_channels: 256
    num_outs: 5
    add_extra_convs: true
    extra_convs_on_inputs: false
  
  rpn:
    anchor_scales: [8, 16, 32]
    anchor_ratios: [0.5, 1.0, 2.0]
    anchor_strides: [4, 8, 16, 32, 64]
    target_means: [0.0, 0.0, 0.0, 0.0]
    target_stds: [1.0, 1.0, 1.0, 1.0]
    feat_channels: 256
    use_sigmoid_cls: true
    nms_pre: 2000
    nms_post: 2000
    nms_thr: 0.7
    min_bbox_size: 0
    num_max_proposals: 2000
  
  roi:
    roi_layer:
      type: 'RoIAlign'
      out_size: [7, 7]
      sample_num: 2
    roi_size: [7, 7]
    roi_sample_num: 2
    target_means: [0.0, 0.0, 0.0, 0.0]
    target_stds: [0.1, 0.1, 0.2, 0.2]
    reg_class_agnostic: false
    classes: 5  # background + 4 classes (Normal, Sclerotic, Partially_sclerotic, Uncertain)
  
  cascade:
    num_stages: 3
    stage_loss_weights: [1, 0.5, 0.25]
    bbox_reg_weights: 
      - [10.0, 10.0, 5.0, 5.0]
      - [20.0, 20.0, 10.0, 10.0]
      - [30.0, 30.0, 15.0, 15.0]
    iou_thresholds: [0.5, 0.6, 0.7]
  
  mask:
    roi_size: [14, 14]
    in_channels: 256
    conv_kernel_size: 1
    classes: 4  # background + 3 classes (GN, GL, GS)
  
  num_classes: 4  # background + 3 classes (GN, GL, GS)
  pretrained: null

# Training configuration
training:
  seed: 42
  epochs: 12
  batch_size: 2
  workers: 4
  
  optimizer:
    type: 'SGD'
    lr: 0.005
    momentum: 0.9
    weight_decay: 0.0001
  
  lr_scheduler:
    type: 'multistep'
    milestones: [8, 11]
    gamma: 0.1
  
  data:
    dataset_type: 'GlomeruliDataset'
    train_path: 'data/train'
    val_path: 'data/val'
    test_path: 'data/test'
    img_size: [1024, 1024]
    classes: ['GN', 'GL', 'GS']
    
    # Data augmentation
    use_augmentation: true
    augmentations:
      horizontal_flip:
        p: 0.5
      vertical_flip:
        p: 0.5
      random_rotate_90:
        p: 0.5
      transpose:
        p: 0.5
      random_crop:
        p: 0.3
        height: 800
        width: 800
    
    # Normalization
    mean: [0.485, 0.456, 0.406]
    std: [0.229, 0.224, 0.225]
  
  # Loss weights
  rpn_cls_loss_weight: 1.0
  rpn_bbox_loss_weight: 1.0
  rcnn_cls_loss_weight: 1.0
  rcnn_bbox_loss_weight: 1.0
  mask_loss_weight: 1.0
  
  # Checkpointing and logging
  checkpoint_dir: 'experiments/checkpoints'
  log_dir: 'experiments/logs'
  save_freq: 1
  eval_freq: 1
  log_freq: 10
  
  # Distributed training
  distributed: false
  gpu_ids: [0]
  
  # Debugging
  debug: false
  debug_samples: 10